{
    "systemPurpose": "水道工事・公共工事・外注・代理店工事を完全統合する母艦システム。全てのデータはProjectID中心でリンクされ、現場〜事務〜役員〜外注〜代理店までを一元管理する。",
    "corePrinciples": {
        "projectIDCentralization": true,
        "offlineFirst": true,
        "multiDeviceSync": [
            "iOS",
            "Android",
            "PC"
        ],
        "templateEditableBy": [
            "executive"
        ],
        "aiLayerSeparation": {
            "internalAI": "ルールベース＋軽量推論。現場オフラインでも稼働。",
            "externalAI": "OpenAI等で重たい処理のみ担当（OCR/PDF解析/文章生成）。"
        },
        "workflowIntegrity": "依頼→見積→契約→工事→黒板→作図→数量→書類→完了→請求→入金 の流れを壊さない"
    },
    "roles": {
        "executive": [
            "全権限",
            "テンプレ編集",
            "材料マスタ編集"
        ],
        "office": [
            "事務業務",
            "書類作成",
            "請求管理"
        ],
        "worker": [
            "現場記録",
            "黒板入力",
            "写真提出"
        ],
        "outsourcing": [
            "現場写真提出",
            "完了書提出",
            "外注請求アップ"
        ],
        "agency": [
            "進捗監視",
            "完了写真閲覧",
            "月次請求閲覧"
        ],
        "customer": [
            "将来対応"
        ]
    },
    "contextModel": {
        "staticContext": [
            "工事ID中心主義",
            "権限に応じたUI",
            "母艦データベースに集約",
            "外注/代理店は工事IDにより可視範囲制限"
        ],
        "dynamicContext": {
            "perProject": {
                "projectID": "string",
                "board": "BoardData",
                "drawings": "DrawingData",
                "quantities": "QuantityData",
                "materials": "MaterialUsageData",
                "publicDocs": "PublicDocsData",
                "billing": "BillingData",
                "payment": "PaymentData",
                "progressStatus": "string",
                "aiResult": "AIResultData"
            }
        },
        "templateContext": {
            "editableByExecutive": [
                "BoardTemplate",
                "DrawingTemplate",
                "PublicDocTemplate",
                "CompletionTemplate",
                "BillingTemplate",
                "PhotoLedgerTemplate",
                "WorkflowTemplate",
                "MaterialMaster",
                "QuantityLogicJSON"
            ]
        }
    },
    "boardSystem": {
        "features": [
            "黒板テンプレート",
            "黒板項目入力",
            "配管図作図",
            "土工図自動生成",
            "黒板写真合成",
            "AIの項目不足チェック",
            "数量まで連動"
        ]
    },
    "drawingSystem": {
        "pipingDiagram": {
            "elementsStructure": {
                "id": "string",
                "type": "socket | elbow | tee | line | text | custom",
                "position": {
                    "x": "number",
                    "y": "number"
                },
                "rotation": "number",
                "properties": {
                    "diameter": "string",
                    "material": "string"
                }
            },
            "metadata": {
                "scale": "number",
                "createdAt": "date",
                "updatedAt": "date"
            }
        },
        "autogeneratedDrawings": [
            "EarthworkDiagram",
            "PlanDiagram",
            "SectionDiagram",
            "PublicSubmissionPDF"
        ],
        "linkingToDocuments": {
            "logic": "pipingDiagram.elements → QuantityLogic(JSON) → Quantity → Billing/PublicDocs/Completion",
            "description": "配管図のノード・線・継手の入力内容が数量計算へ反映され、その数量が公共書類・完了書・請求書へ自動連動する。"
        }
    },
    "aiRules": {
        "1": "推測で答えない",
        "2": "回答は常に構造的に",
        "3": "ProjectID中心の設計を維持する",
        "4": "ワークフローを破壊する提案は禁止",
        "5": "テンプレ編集権限を遵守する",
        "6": "外注/代理店データは工事IDでフィルタ",
        "7": "オフライン現場の可用性を損なわない",
        "8": "個人宅工事と公共工事を混同しない",
        "9": "配管図→数量→書類のデータ連動を維持"
    },
    "workflow": [
        "依頼",
        "見積",
        "契約",
        "工事開始",
        "黒板",
        "作図（配管図）",
        "数量自動拾い出し",
        "公共書類／完了書／請求書生成",
        "工事完了",
        "請求",
        "入金"
    ],
    "databaseModel": {
        "Project": [
            "projectID",
            "customer",
            "location",
            "status"
        ],
        "Board": [
            "projectID",
            "boardData",
            "templateID"
        ],
        "Drawing": [
            "projectID",
            "pipingDiagram",
            "earthwork",
            "plan",
            "section"
        ],
        "Quantity": [
            "projectID",
            "items"
        ],
        "MaterialUsage": [
            "projectID",
            "materials"
        ],
        "PublicDocs": [
            "projectID",
            "documents"
        ],
        "Completion": [
            "projectID",
            "completionData"
        ],
        "Billing": [
            "projectID",
            "billingData"
        ],
        "Payment": [
            "projectID",
            "payments"
        ],
        "OutsourceReport": [
            "projectID",
            "outsourcingData"
        ],
        "AIResult": [
            "projectID",
            "results"
        ]
    },
    "futureExtensions": [
        "顧客ポータル",
        "役所ポータル（臨場チャット）",
        "3D配管図生成",
        "画像→数量推定AI",
        "工事位置マップ表示",
        "OEM提供"
    ]
}